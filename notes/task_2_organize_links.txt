// =================================================================
// TASK 2: ASSIGNMENT MAPPING (The Sorter)
// Goal: Assign a chunk of links to the fixed folder paths generated by the client.
// Runs repeatedly for every chunk of data.
// =================================================================

/**
 * 2A. JSON Schema for Task 2 Output (Array of Link-to-Path Maps)
 */
const TASK2_LINK_ASSIGNMENT_SCHEMA = {
  type: "ARRAY",
  description: "An array mapping each link's unique ID to the most appropriate folder path.",
  items: {
    type: "OBJECT",
    properties: {
      linkId: {
        type: "STRING",
        description: "The unique ID of the bookmark, copied exactly from the input."
      },
      folderPath: {
        type: "STRING",
        description: "The assigned folder path. MUST be one of the paths provided in the prompt OR an empty string '' for the root Bookmarks Bar."
      }
    },
    required: ["linkId", "folderPath"],
    additionalProperties: false
  }
};

/**
 * 2B. System Instruction for Task 2
 * NOTE: The [INJECTED PATHS] placeholder is where your JS will insert the results from Task 1.
 */
function getTask2SystemPrompt(canonicalPaths) {
    // Escape the paths list to be safely included inside the prompt's context block
    const pathsContext = JSON.stringify(canonicalPaths, null, 2);

    return `
You are a Bookmark Sorter. Your task is to assign each provided bookmark to the most relevant folder path from the canonical list provided below.

RULES:
1.  OUTPUT MUST BE a single, valid JSON array that conforms EXACTLY to the 'responseConstraint' schema. Do not add any conversational text or formatting.
2.  The output must include every 'linkId' from the input, copied exactly.
3.  The 'folderPath' assigned MUST be one of the paths provided in the 'CANONICAL FOLDER PATHS' list, or an empty string "" if the link should remain in the root Bookmarks Bar.
4.  Do NOT create new folder paths.

CANONICAL FOLDER PATHS:
${pathsContext}
`;
}

/**
 * 2C. Example of the Input (User Query) for Task 2
 * This is a sample chunk of data your JS will provide to the prompt() method.
 */
const TASK2_USER_QUERY_EXAMPLE = `
ASSIGN the following links to the most relevant folder path:

Link 1: ID: link_1234; Title: Gemini Nano Prompt API; URL: https://ai.google.dev/docs/nano
Link 2: ID: link_5678; Title: How to Save Money; URL: https://money.com/saving-tips
Link 3: ID: link_9012; Title: Python Pandas Dataframes; URL: https://pandas.pydata.org/docs
`;

/**
 * 2D. Example of the Expected Output for Task 2 (JSON String)
 * Assumes the canonical paths from Task 1 were provided.
 */
const TASK2_EXPECTED_OUTPUT = JSON.stringify([
  {
    "linkId": "link_1234",
    "folderPath": "AI & On-Device Models"
  },
  {
    "linkId": "link_5678",
    "folderPath": "" // Assigned to root since no 'Money' folder exists
  },
  {
    "linkId": "link_9012",
    "folderPath": "Data Science & Python"
  }
], null, 2);